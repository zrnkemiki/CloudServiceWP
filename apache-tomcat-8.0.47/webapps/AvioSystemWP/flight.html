<!DOCTYPE html>
<html>
<head>
	<title>Flight</title>
	<meta charset="ISO-8859-1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="js/printNavBar.js"></script>
  <script src="js/flights.js"></script>

	<link rel="stylesheet" href="css/authentication.css">
	<link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/flights.css">

</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">

      </ul>
      <ul class="nav navbar-nav navbar-right">

      </ul>
    </div>
  </div>
</nav>

  <div class="container-fluid text-center">
    <div id="flight-list" class="row list-group">
      <div class="row">
        <div class="col-lg-8 col-md-8 col-sm-8 col-lg-offset-2">
          <div class="ticket-card">
            <div class="info">
              <div class="going">
                <i class="fa fa-group" id="flight-type"></i>
              </div>
            </div>
            <div class="body">
              
              <div class="artist">
                <h7 class="info">from</h7>
                <h4 class="name" id="from-dest"></h4>
                <h7 class="info"> to</h7>
                <h4 class="name" id="to-dest"></h4>
              </div>
              <div class="price">
                <div class="from">From</div>
                <div class="value" id="min-price">
                  <b class="dollar-sign"></b>
                </div>
              </div>
              
              <div class="clearfix"></div>
              <div class="info">
                <p class="date" id="date">
                  <i class="fa fa-calendar" id="departure"></i>
                </p>
              </div>
              <div class="clearfix"></div>
            </div>
            <div class="collapse">
              <ul class="list-unstyled">
                <li>
                  <div class="ticket">
                    <h5>Economy Class<br></h5>
                  </div>
                  <div class="price">
                    <div class="value" id="economy-price"><b class="dollar-sign"></b></div>
                  </div>
                  <div id="reserve-economy"><a class="btn btn-info btn-sm btn-buy">Reserve!</a></div>
                </li>
                <li>
                  <div class="ticket">
                    <h5>Business Class<br></h5>
                  </div>
                  <div class="price">
                    <div class="value" id="business-price"><b class="dollar-sign"></b></div>
                  </div>
                  <div id="reserve-business"><a class="btn btn-info btn-sm btn-buy">Reserve!</a></div>
                </li>
                <li>
                  <div class="ticket">
                    <h5>First Class<br></h5>
                  </div>
                  <div class="price">
                    <div class="value" id="first-class-price"><b class="dollar-sign"></b></div>
                  </div>
                  <div id="reserve-first-class"><a class="btn btn-info btn-sm btn-buy">Reserve!</a></div>
                </li>
              </ul>
              <label>Number of passengers:  </label>
              <div class="form-group">
                <input type="number" class="form-control" id="passenger-number" name="passenger-number" min="1" max="10">
              </div>
            </div>
            <div class="footer">
              <button class="btn toggle-tickets">Make reservation!</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
  var busOffer = 1.6;
  var firstOffer = 1.9;
  var fID = -1;

    $(document).ready(function() {
        printNav("flight.html");
    })

    $(document).ready(function() {
      var urlParams = getUrlVars();
      var flightID = urlParams.id;
      fID = flightID;
      $.ajax({
        type: "GET",
        url: "rest/flight/" + flightID,
        dataType: "json",
        success: function(flight) {

          var flightType = flight.flightType;
          var destFrom = flight.fromDestination.name + " [" + flight.fromDestination.airportCode + "]";
          var destTo = flight.toDestination.name + " [" + flight.toDestination.airportCode + "]";
          var defaultPrice = flight.price;
          var departureDate = flight.departureDate;

          var businessPrice = defaultPrice * busOffer;
          var firstClassPrice = defaultPrice * firstOffer;

          $("#flight-type").text(flightType + ' FLIGHT');
          $("#from-dest").text(destFrom);
          $("#to-dest").text(destTo);
          $("#min-price").text('$' + defaultPrice);
          $("#departure").text(departureDate);
          $("#economy-price").text('$' + defaultPrice);
          $("#business-price").text('$' + businessPrice);
          $("#first-class-price").text('$' + firstClassPrice);
        },
        error: function(response) {
          alert("Something went wrong while getting flight..........");
        }
      })
    })


    $(document).ready(function() {
      $("#reserve-economy").click(function() {
        var reservation = {};
        var flID = fID;
        var numberOfPassengers = $("#passenger-number").val();
        var flightClass = 2;

        var passengerNumber = Number(numberOfPassengers);

        if (!isNaN(passengerNumber) && passengerNumber.toString().indexOf('.') != -1) {
          alert("Passenger number has to be positive integer!");
        }

        if (numberOfPassengers == "" || numberOfPassengers == null) {
          alert("Please eneter number of passengers!");
          return;
        }

        reservation.flightId = flID;
        reservation.flightClass = flightClass;
        reservation.numberOfPassengers = passengerNumber;

        $.ajax({
          type: "POST",
          url: "rest/reservation",
          dataType: "json",
          contentType: "application/json",
          data: JSON.stringify(reservation),
          success: function(added) {
            alert("Congratulations! You have made a reservation for this flight!");
            window.location.replace("reservations.html");
          },
          error: function(response, xhr) {
            if (xhr.status == 400) {
              alert("Please fill the form correctly!");
            } else if (xhr.status == 403) {
              alert("Please log in if you want to make reservation!");
              window.location.replace("authentication.html");
            } else if (xhr.status == 404) {
              alert("Oops, flight cannot be found.....");
            } else if (xhr.status == 409) {
              alert("Sorry, but all the seats are already taken for this flight. ");
            }
          }
        })


      })
    });

    $(document).ready(function() {
      $("#reserve-business").click(function() {
        var reservation = {};
        var flID = fID;
        var numberOfPassengers = $("#passenger-number").val();
        var flightClass = 1;

        var passengerNumber = Number(numberOfPassengers);

        if (!isNaN(passengerNumber) && passengerNumber.toString().indexOf('.') != -1) {
          alert("Passenger number has to be positive integer!");
        }

        if (numberOfPassengers == "" || numberOfPassengers == null) {
          alert("Please eneter number of passengers!");
          return;
        }

        reservation.flightId = flID;
        reservation.flightClass = flightClass;
        reservation.numberOfPassengers = passengerNumber;

        $.ajax({
          type: "POST",
          url: "rest/reservation",
          dataType: "json",
          contentType: "application/json",
          data: JSON.stringify(reservation),
          success: function(added) {
            alert("Congratulations! You have made a reservation for this flight!");
            window.location.replace("reservations.html");
          },
          error: function(response, xhr) {
            if (xhr.status == 400) {
              alert("Please fill the form correctly!");
            } else if (xhr.status == 403) {
              alert("Please log in if you want to make reservation!");
              window.location.replace("authentication.html");
            } else if (xhr.status == 404) {
              alert("Oops, flight cannot be found.....");
            } else if (xhr.status == 409) {
              alert("Sorry, but all the seats are already taken for this flight. ");
            }
          }
        })



      })
    });

    $(document).ready(function() {
      $("#reserve-first-class").click(function() {
        var reservation = {};
        var flID = fID;
        var numberOfPassengers = $("#passenger-number").val();
        var flightClass = 0;

        var passengerNumber = Number(numberOfPassengers);

        if (!isNaN(passengerNumber) && passengerNumber.toString().indexOf('.') != -1) {
          alert("Passenger number has to be positive integer!");
        }

        if (numberOfPassengers == "" || numberOfPassengers == null) {
          alert("Please eneter number of passengers!");
          return;
        }

        reservation.flightId = flID;
        reservation.flightClass = flightClass;
        reservation.numberOfPassengers = passengerNumber;

        $.ajax({
          type: "POST",
          url: "rest/reservation",
          dataType: "json",
          contentType: "application/json",
          data: JSON.stringify(reservation),
          success: function(added) {
            alert("Congratulations! You have made a reservation for this flight!");
            window.location.replace("reservations.html");
          },
          error: function(response, xhr) {
            if (xhr == 400) {
              alert("Please fill the form correctly!");
            } else if (xhr.status == 403) {
              alert("Please log in if you want to make reservation!");
              window.location.replace("authentication.html");
            } else if (xhr.status == 404) {
              alert("Oops, flight cannot be found.....");
            } else if (xhr.status == 409) {
              alert("Sorry, but all the seats are already taken for this flight. ");
            }
          }
        })


      })
    })


  function getUrlVars()
  {
      var vars = [], hash;
      var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
      for(var i = 0; i < hashes.length; i++)
      {
          hash = hashes[i].split('=');
          vars.push(hash[0]);
          vars[hash[0]] = hash[1];
      }
      return vars;
  }


</script>


</body>
</html>