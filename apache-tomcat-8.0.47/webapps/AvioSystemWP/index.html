<!DOCTYPE html>
<html>
<head>
    <title>FTN Airlines</title>
    <meta charset="ISO-8859-1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/printNavBar.js"></script>
    <script src="js/flights.js"></script>

    <link rel="stylesheet" href="css/authentication.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/flights.css">

</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav" id="myNavbarList">

      </ul>
      <ul class="nav navbar-nav navbar-right" id="log-bar">

      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid text-center">    
  <div class="row content">
    <div class="col-sm-8 text-left"> 
      <div class="container">
      <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <div class="panel panel-login">
          <div class="panel-heading">
            <h3>Search Flights</h3>
            <hr>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-lg-12">
                <form id="search-form" role="form" style="display: block;">
                  <div class="form-group">
                    <div class="col-lg-4">
                      <div class="radio">
                        <label><input type="radio" data-name="search-type-dest" name="search-type" value="by-destination" checked>By Destination</label>
                      </div>
                    </div>
                    <div class="col-lg-4">
                      <div class="radio">
                        <label><input type="radio" data-name="search-type-country" name="search-type" value="by-country">By Country</label>
                      </div>
                    </div>
                    <div class="col-lg-4">
                      <div class="radio">
                        <label><input type="radio" data-name="search-type-departure" name="search-type" value="by-departure">By Departure</label>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <input type="text" name="from-destination" id="from-destination" tabindex="1" class="form-control" placeholder="From destination" value="">
                  </div>
                  <div class="form-group">
                    <input type="text" name="to-destination" id="to-destination" tabindex="1" class="form-control" placeholder="To destination" value="">
                  </div>
                  <div class="form-group">
                    <input type="text" name="from-country" id="from-country" tabindex="1" class="form-control" placeholder="From country" value="" disabled>
                  </div>
                  <div class="form-group">
                    <input type="text" name="to-country" id="to-country" tabindex="1" class="form-control" placeholder="To country" value="" disabled>
                  </div>
                  <div class="form-group">
                    <input type="date" name="departure-date" id="departure-date" tabindex="1" class="form-control" placeholder="mm/dd/yyyy" value="" min="2019-02-01" disabled>
                  </div>
                  <div class="form-group">
                    <div class="row">
                      <div class="col-sm-6">
                        <input type="button" name="search-btn" id="search-btn" tabindex="4" class="form-control btn btn-primary" value="SEARCH">
                      </div>
                      <div class="col-sm-6">
                        <button type="button" name="advanced-btn" id="advanced-btn" tabindex="4" class="form-control btn btn-primary" data-toggle="collapse" data-target="#filter-panel"><span class="glyphicon glyphicon-cog"></span> FILTERS
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
  </div>

    <div class="row">
        <div class="col-sm-8 text-left">
            <div class="container">
                <div class="row">
                <div class="col-md-6 col-md-offset-3">
                <div id="filter-panel" class="collapse filter-panel">
                    <div class="panel panel-login">
                        <div class="panel-heading">
                            <h3>Filters</h3>
                            <hr>
                        </div>
                        <div class="panel-body">
                            <form class="form" role="form" id="filter-form">
                                <div class="form-group">
                                    <div class="col-md-5 col-md-offset-1">
                                        <label>Basic filters</label>
                                        <div class="radio">
                                            <label><input type="radio" data-name="NEWEST" name="filter-opt" checked>Newest</label>
                                        </div>
                                        <div class="radio">
                                            <label><input type="radio" data-name="FLIGHTNUMBER" name="filter-opt">Flight Number</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-md-offset-2">
                                        <label>Filter by class</label>
                                        <div class="radio">
                                            <label><input type="radio" data-name="CHARTER" name="filter-opt">Charter</label>
                                        </div>
                                        <div class="radio">
                                            <label><input type="radio" data-name="REGIONAL" name="filter-opt">Regional</label>
                                        </div>
                                        <div class="radio">
                                            <label><input type="radio" data-name="OVERSEAS" name="filter-opt">Overseas</label>
                                        </div>
                                    </div>
                                
                                </div> <!-- form group [rows] -->
                                  <div class="form-group">
                                    <div class="row">
                                      <div class="col-sm-6 col-sm-offset-3">
                                        <input type="button" title="Apply only filter" name="filter-submit-btn" id="filter-submit-btn" tabindex="4" class="form-control btn btn-primary" value="FILTER">
                                      </div>
                                  </div>
                                  <br>
                                  <div class="row">
                                      <div class="col-sm-6 col-sm-offset-3">
                                        <input type="button" title="Apply both filter & search" name="search-filter-submit-btn" id="search-filter-submit-btn" tabindex="4" class="form-control btn btn-primary" value="SEARCH & FILTER">
                                      </div>
                                    </div>
                                  </div>

                            </form>
                        </div>
                    </div>
                </div>    
            </div>

        </div>
    </div>
    </div>
    </div>

    <div id="flight-list" class="row list-group">
      
    </div>

</div>

<script>

    $(document).ready(function() {
        printNav("index.html");
    })


    $("input[type='radio'][name='search-type']").change(function() {
      if(this.value == 'by-destination') {
        $("#from-destination").val("");
        $("#from-destination").prop('disabled', false);
        $("#to-destination").val("");
        $("#to-destination").prop('disabled', false);
        $("#from-country").val("");
        $("#from-country").prop('disabled', true);
        $("#to-country").val("");
        $("#to-country").prop('disabled', true);
        $("#departure-date").val("");
        $("#departure-date").prop('disabled', true);

      } else if (this.value == 'by-country') {
        $("#from-destination").val("");
        $("#from-destination").prop('disabled', true);
        $("#to-destination").val("");
        $("#to-destination").prop('disabled', true);
        $("#from-country").val("");
        $("#from-country").prop('disabled', false);
        $("#to-country").val("");
        $("#to-country").prop('disabled', false);
        $("#departure-date").val("");
        $("#departure-date").prop('disabled', true);
      } else if (this.value == "by-departure") {
        $("#from-destination").val("");
        $("#from-destination").prop('disabled', true);
        $("#to-destination").val("");
        $("#to-destination").prop('disabled', true);
        $("#from-country").val("");
        $("#from-country").prop('disabled', true);
        $("#to-country").val("");
        $("#to-country").prop('disabled', true);
        $("#departure-date").val("");
        $("#departure-date").prop('disabled', false);
      }
    })




    $("#search-btn").click(function() {
      var sFromDestination = $("#from-destination").val();
      var sToDestination = $("#to-destination").val();
      var sFromCountry = $("#from-country").val();
      var sToCountry = $("#to-country").val();
      var sDepartureDate = $("#departure-date").val();

      if (sFromDestination == "" || sFromDestination == null) {
        sFromDestination = "1";
      }
      if (sToDestination == "" || sToDestination == null) {
        sToDestination = "1";
      }
      if (sFromCountry == "" || sFromCountry == null) {
        sFromCountry = "1";
      }
      if (sToCountry == "" || sToCountry == null) {
        sToCountry = "1";
      }
      if (sDepartureDate == "" || sDepartureDate == null) {
        sDepartureDate = "1";
      }

      if (sFromDestination == "" && sToDestination == "" && sFromCountry == "" && sToCountry == "" && sDepartureDate == "") {
      	alert("You have to fill the form if you want to search!");
      	return;
      }

      $("#flight-list").empty();

      $.ajax({
        type: "GET",
        url: "rest/flight/search",
        data: {
          'fromDestination': sFromDestination,
          'toDestination': sToDestination,
          'fromCountry': sFromCountry,
          'toCountry': sToCountry,
          'departure': sDepartureDate
        },
        dataType: "json",
        success: function(flights) {
          var panels = "";
          $.each(flights, function(i, flight) {
            var dat = flight.departureDate;
            var fo = dat.substring(0, dat.length - 9);
            var splited = fo.split("T");
            var dateFormated = splited[0] + ' ' + splited[1];

            var panel = "";
            panel += '<div class="col-lg-4 col-md-6 col-sm-6">';
            panel += '<div class="ticket-card">';
            panel += '<div class="body">';
            panel += '<div class="artist">';
            panel += '<h7 class="info">from</h7>';
            panel += '<h4 class="name">' + flight.fromDestination.name + " [" + flight.fromDestination.airportCode + "]" + '</h4>';
            panel += '<h7 class="info"> to</h7>';
            panel += '<h4 class="name">' + flight.toDestination.name + "[" + flight.toDestination.airportCode + "]" + '</h4>';
            panel += '</div>';
            panel += '<div class="price">';
            panel += '<div class="from">From</div>';
            panel += '<div class="value">';
            panel += '<b>$</b>' + flight.price;
            panel += '</div>';
            panel += '</div>';
            panel += '<div class="clearfix"></div>';
            panel += '<div class="info">';
            panel += '<p class="date">';
            panel += '<i class="fa fa-calendar"></i>' + dateFormated;
            panel += '</p>';
            panel += '</div>';
            panel += '<div class="clearfix"></div>';
            panel += '</div>';
            panel += '<div class="footer">';
            panel += '<a href="flight.html?id=' + flight.id + '" class="btn btn-info btn-sm btn-by">Buy Now!</a>';
            panel += '</div>';
            panel += '</div>';
            panel += '</div>';
            panels += panel;
          });
          $("#flight-list").append(panels);

        },
        error: function(response, xhr) {
          alert("Ooops, something went wrong while searching for flights.....");
        }
      })

    })


    $("#filter-submit-btn").click(function() {
      var filter = $("input[name='filter-opt']:checked").data('name');
      $("#flight-list").empty();

      $.ajax({
        type: "GET",
        url: "rest/flight/filter",
        data: {
          'flightType': filter
        },
        dataType: "json",
        success: function(flights) {
          var panels = "";
          $.each(flights, function(i, flight) {
            var dat = flight.departureDate;
            var fo = dat.substring(0, dat.length - 9);
            var splited = fo.split("T");
            var dateFormated = splited[0] + ' ' + splited[1];

            var panel = "";
            panel += '<div class="col-lg-4 col-md-6 col-sm-6">';
            panel += '<div class="ticket-card">';
            panel += '<div class="body">';
            panel += '<div class="artist">';
            panel += '<h7 class="info">from</h7>';
            panel += '<h4 class="name">' + flight.fromDestination.name + " [" + flight.fromDestination.airportCode + "]" + '</h4>';
            panel += '<h7 class="info"> to</h7>';
            panel += '<h4 class="name">' + flight.toDestination.name + "[" + flight.toDestination.airportCode + "]" + '</h4>';
            panel += '</div>';
            panel += '<div class="price">';
            panel += '<div class="from">From</div>';
            panel += '<div class="value">';
            panel += '<b>$</b>' + flight.price;
            panel += '</div>';
            panel += '</div>';
            panel += '<div class="clearfix"></div>';
            panel += '<div class="info">';
            panel += '<p class="date">';
            panel += '<i class="fa fa-calendar"></i>' + dateFormated;
            panel += '</p>';
            panel += '</div>';
            panel += '<div class="clearfix"></div>';
            panel += '</div>';
            panel += '<div class="footer">';
            panel += '<a href="flight.html?id=' + flight.id + '" class="btn btn-info btn-sm btn-by">Buy Now!</a>';
            panel += '</div>';
            panel += '</div>';
            panel += '</div>';
            panels += panel;
          });
          $("#flight-list").append(panels);
        },
        error: function(response) {
          alert("Something went wrong while getting filtered flights!");
        }
      })
    })

    $("#search-filter-submit-btn").click(function() {
      var sFromDestination = $("#from-destination").val();
      var sToDestination = $("#to-destination").val();
      var sFromCountry = $("#from-country").val();
      var sToCountry = $("#to-country").val();
      var sDepartureDate = $("#departure-date").val();
      var filter = $("input[name='filter-opt']:checked").data('name');

      if (sFromDestination == "" || sFromDestination == null) {
        sFromDestination = "1";
      }
      if (sToDestination == "" || sToDestination == null) {
        sToDestination = "1";
      }
      if (sFromCountry == "" || sFromCountry == null) {
        sFromCountry = "1";
      }
      if (sToCountry == "" || sToCountry == null) {
        sToCountry = "1";
      }
      if (sDepartureDate == "" || sDepartureDate == null) {
        sDepartureDate = "1";
      }

      if (sFromDestination == "" && sToDestination == "" && sFromCountry == "" && sToCountry == "" && sDepartureDate == "") {
      	alert("You have to fill the form if you want to search&filter! If you want just filter, click on button FILTER.");
      	return;
      }
      $("#flight-list").empty();

      $.ajax({
        type: "GET",
        url: "rest/flight/filtersearch",
        data: {
          'fromDestination': sFromDestination,
          'toDestination': sToDestination,
          'fromCountry': sFromCountry,
          'toCountry': sToCountry,
          'departure': sDepartureDate,
          'flightType': filter                    
        },
        dataType: "json",
        success: function(flights) {
          var panels = "";
          $.each(flights, function(i, flight) {
            var dat = flight.departureDate;
            var fo = dat.substring(0, dat.length - 9);
            var splited = fo.split("T");
            var dateFormated = splited[0] + ' ' + splited[1];

            var panel = "";
            panel += '<div class="col-lg-4 col-md-6 col-sm-6">';
            panel += '<div class="ticket-card">';
            panel += '<div class="body">';
            panel += '<div class="artist">';
            panel += '<h7 class="info">from</h7>';
            panel += '<h4 class="name">' + flight.fromDestination.name + " [" + flight.fromDestination.airportCode + "]" + '</h4>';
            panel += '<h7 class="info"> to</h7>';
            panel += '<h4 class="name">' + flight.toDestination.name + "[" + flight.toDestination.airportCode + "]" + '</h4>';
            panel += '</div>';
            panel += '<div class="price">';
            panel += '<div class="from">From</div>';
            panel += '<div class="value">';
            panel += '<b>$</b>' + flight.price;
            panel += '</div>';
            panel += '</div>';
            panel += '<div class="clearfix"></div>';
            panel += '<div class="info">';
            panel += '<p class="date">';
            panel += '<i class="fa fa-calendar"></i>' + dateFormated;
            panel += '</p>';
            panel += '</div>';
            panel += '<div class="clearfix"></div>';
            panel += '</div>';
            panel += '<div class="footer">';
            panel += '<a href="flight.html?id=' + flight.id + '" class="btn btn-info btn-sm btn-by">Buy Now!</a>';
            panel += '</div>';
            panel += '</div>';
            panel += '</div>';
            panels += panel;
          });
          $("#flight-list").append(panels);
        },
        error: function(response) {
          alert("Oopss, something went wrong while applying search&filter...");
        }
      });
    });


</script>




</body>
</html>