<!DOCTYPE html>
<html>
<head>
	<title>New Flight</title>
	<meta charset="ISO-8859-1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="js/printNavBar.js"></script>

	<link rel="stylesheet" href="css/authentication.css">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li><a href="admin-profile.html">Profile</a></li>
        <li><a href="add-destination.html">New Destination</a></li>
        <li><a href="edit-destination.html">Edit Destination</a></li>
        <li><a href="archive-destination.html">Archive Destination</a></li>
        <li class="active"><a href="add-flight.html">New Flight</a></li>
        <li><a href="edit-flight.html">Edit Flight</a></li>
        <li><a href="delete-flight.html">Delete Flight</a></li>
        <li><a href="activate-user.html">Activate User</a></li>
        <li><a href="block-user.html">Block User</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a onclick="logout()" id="logout-btn"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid text-center">    
  <div class="row content">
    <div class="col-sm-8 text-left"> 
      <div class="container">
      <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <div class="panel panel-login">
          <div class="panel-heading">
            <h3>Add New Flight</h3>
            <hr>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-lg-12">
                <form id="destination-form" role="form" style="display: block;">
                  <div class="form-group">
                    <input type="text" name="flight-number" id="flight-number" tabindex="1" class="form-control" placeholder="Fligh number (e.g. YU123)" value="">
                  </div>
                  <div class="form-group">
                    <label for="select-from-dest">From destination:</label>
                    <select class="form-control" id="from-destination">
                      
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="select-to-dest">To destination:</label>
                    <select class="form-control" id="to-destination">
                      
                    </select>
                  </div>                  
                  <div class="form-group">
                    <input type="text" name="airplane-model" id="airplane-model" tabindex="1" class="form-control" placeholder="Airplane model" value="">
                  </div>
                  <div class="form-group">
                    <input type="number" name="price" id="price" tabindex="1" class="form-control" placeholder="Basic price ($$$)" value="" min="0" max="10000" step="5">
                  </div>
                  <div class="col-lg-6">
                  	<div class="form-group">
                  		<input type="number" name="first-class-seats" id="first-class-seats" tabindex="1" class="form-control" placeholder="First class seats number" value="" min="0" max="150">
                  	</div>
                  </div>
                  <div class="col-lg-6">
                  	<div class="form-group">
                  		<input type="number" name="business-class-seats" id="business-class-seats" tabindex="1" class="form-control" placeholder="Business class seats number" value="" min="0" max="150">
                  	</div>
                  </div>
                  <div class="col-lg-6">
                  	<div class="form-group">
                  		<input type="number" name="economy-class-seats" id="economy-class-seats" tabindex="1" class="form-control" placeholder="Economy class seats number" value="" min="0" max="800">
                  	</div>
                  </div>
                  <div class="col-lg-6">
                  	<div class="form-group">
                  		<input type="datetime-local" name="flight-departure" id="flight-departure" tabindex="1" class="form-control" value="">
                  	</div>
                  </div>
                  <div class="form-group">
                    <label>Type of flight:</label>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <div class="radio">
                        <label><input type="radio" data-name="CHARTER" name="flight-type" checked>Charter</label>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <div class="radio">
                        <label><input type="radio" data-name="REGIONAL" name="flight-type">Regional</label>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <div class="radio">
                        <label><input type="radio" data-name="OVERSEAS" name="flight-type">Overseas</label>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="row">
                      <div class="col-sm-6 col-sm-offset-3">
                        <br>
                        <input type="button" name="add-btn" id="add-btn" tabindex="4" class="form-control btn btn-register" value="Add Flight!">
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    </div>
  </div>
</div>

<script>

  $(function() {
    restrict();
  })


  $(function() {
    $.ajax({
     type: "GET", 
     url: "rest/destination/all",
     dataType: "json",
     success: function(destinations) {
       $("#from-destination").empty();
       $("#from-destination").attr('disabled',false);
       $("#to-destination").empty();
       $("#to-destination").attr('disabled', false);

       if (destinations.length == 0) {
         $("#from-destination").attr('disabled',true);
         $("#to-destination").attr('disabled', true);
         alert("No destinations found!");
       }
       
       $.each(destinations, function(i, destination) {

         var txt = "[" + destination.airportCode + "]" + destination.name + ", " + destination.country;
         $("#from-destination").append($("<option>", {
           value: destination.id,
           text: txt
         }));
         $("#to-destination").append($("<option>", {
           value: destination.id,
           text: txt
         }));
       });
     },
     error: function() {
       alert("somethings off! (get all destinations)");
       $("#from-destination").attr('disabled',true);
       $("#to-destination").attr('disabled', true);
     },
     async: false
    });
});



  $("#add-btn").click(function() {
    var flight = {};
    var flightCode = $("#flight-number").val();
    var fromDestinationId = $("#from-destination").val();
    var toDestinationId = $("#to-destination").val();
    var airplaneModel = $("#airplane-model").val();
    var departureDateString = $("#flight-departure").val();
    var flightType = $("input[name='flight-type']:checked").data('name');

    var priceString = $("#price").val();
    var firstClassNoString = $("#first-class-seats").val();
    var businessClassNoString = $("#business-class-seats").val();
    var economyClassNoString = $("#economy-class-seats").val();

    var price = Number(priceString);
    var firstClassSeatsNo = Number(firstClassNoString);
    var businessClassSeatsNo = Number(businessClassNoString);
    var economyClassSeatsNo = Number(economyClassNoString);
   

    if (!isNaN(firstClassSeatsNo) && firstClassSeatsNo.toString().indexOf('.') != -1) {
      alert("First class number has to be integer!");
      $("#first-class-seats").val("");
      return;
    } else if (!isNaN(businessClassSeatsNo) && businessClassSeatsNo.toString().indexOf('.') != -1) {
      alert("Business class seats number has to be integer!");
      $("#business-class-seats").val("");
      return;
    } else if (!isNaN(economyClassSeatsNo) && economyClassSeatsNo.toString().indexOf('.') != -1) {
      alert("Economy class seats number has to be integer!");
      $("#economy-class-seats").val("");
      return;
    } 

    if (price < 0 || firstClassSeatsNo < 0 || businessClassSeatsNo < 0 || economyClassSeatsNo < 0) {
      alert("Please fill in the form correctly! Numbers has to be positive!");
      return;
    }

    if (flightCode == "" || airplaneModel == "" || departureDateString == "" || fromDestinationId == "" || fromDestinationId == null || toDestinationId == "" || toDestinationId == null || departureDateString == null) {
      alert("Please fill in the form correctly! You have to fill the entire form!");
      return;
    }

    if (fromDestinationId == toDestinationId) {
      alert("Please choose different destinations in FROM and TO input fields!");
      return;
    }

    flight.flightCode = flightCode;
    flight.toDestinationId = toDestinationId;
    flight.fromDestinationId = fromDestinationId;
    flight.price = price;
    flight.airplaneModel = airplaneModel;
    flight.firstClassSeatsNo = firstClassSeatsNo;
    flight.businessClassSeatsNo = businessClassSeatsNo;
    flight.economyClassSeatsNo = economyClassSeatsNo;
    flight.departureDateString = departureDateString;
    flight.flightType = flightType;

    $.ajax({
      type: "POST",
      url: "rest/flight",
      dataType: "json",
      contentType: "application/json",
      data: JSON.stringify(flight),
      success: function(added) {
        alert("New flight added!");
        window.location.replace("index.html");
      },
      error: function(response, xhr) {
        if (xhr == 400) {
          alert("Please fill the form correctly!");
        } else if (xhr == 409) {
          alert("Sorry! Flight you are looking for cannot be found!");
        } else if (xhr == 415) {
          alert("Date-time cannot be parsed on server...");
        }
        alert("Somethings wrong (while adding new flight...!");
        window.location.reload();
      }

    })


  })


</script>

</body>
</html>